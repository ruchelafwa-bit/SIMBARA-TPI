<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Inventaris Kantor - Elegant Theme</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://apis.google.com/js/api.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
</head>
<link rel="stylesheet" href="style.css">
<body class="font-sans text-gray-900" onload="initApp()">

<script>
  const APP_TITLE = 'Inventaris Kantor';
  const APP_SUBTITLE = 'Sistem Manajemen Barang';
  const APP_LOGO_SVG = `<svg xmlns="http://www.w3.org/2000/svg" fill="white" viewBox="0 0 24 24" stroke="none" class="h-7 w-7"><path d="M3 3v18l9-4 9 4V3H3z"/></svg>`;
</script>

<!-- NAVBAR / HEADER -->
<nav class="flex justify-between items-center px-6 py-3 shadow-md">
  <div class="flex items-center gap-3 select-none" id="navBrand">
    <div class="bg-white bg-opacity-20 rounded p-2" id="navLogo"></div>
    <div class="text-white font-bold text-xl leading-tight">
      <span id="navTitle"></span>
      <div class="text-sm font-normal opacity-80" id="navSubtitle"></div>
    </div>
  </div>
  <div class="flex space-x-3">
    <button id="navDashboard" onclick="showPage('dashboard')" class="flex gap-2 items-center px-4 py-2 bg-transparent border border-transparent rounded-md text-white hover:bg-white hover:text-blue-900 transition font-semibold shadow-sm">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 opacity-70" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M3 12h18M12 3v18"/></svg> Dashboard
    </button>
    <button id="navItems" onclick="showPage('items')" class="flex gap-2 items-center px-4 py-2 rounded-md bg-white text-blue-900 font-semibold shadow-md hover:bg-blue-50 transition">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24"><path d="M20 6H4v12h16V6zM5 16v-2h5v2H5zm0-4v-2h7v2H5z"/></svg> Daftar Barang
    </button>
  </div>
</nav>

<!-- Background Image + blur untuk Dashboard -->
<div id="dashboardBackground"></div>

<main class="max-w-7xl mx-auto px-6 py-8 relative z-10">
  <!-- Dashboard -->
  <section id="dashboard" class="space-y-6">
    <h1 class="text-3xl font-extrabold">Dashboard Inventaris</h1>
    <p class="text-gray-700 max-w-xl">Overview statistik barang kantor</p>
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">

      <div class="bg-gradient-to-r from-blue-600 to-blue-500 text-white p-6 rounded-xl shadow-lg flex justify-between items-center hover:scale-[1.03] transition-transform cursor-default">
        <div>
          <p class="uppercase font-semibold opacity-90 mb-1">Total Barang</p>
          <h2 id="totalBarang" class="text-4xl font-extrabold">0</h2>
        </div>
        <svg fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round" stroke-linecap="round" class="w-14 h-14 opacity-30" viewBox="0 0 24 24"><path d="M3 3v18l9-4 9 4V3H3z"/></svg>
      </div>

      <div class="bg-gradient-to-r from-purple-600 to-purple-500 text-white p-6 rounded-xl shadow-lg flex justify-between items-center hover:scale-[1.03] transition-transform cursor-default">
        <div>
          <p class="uppercase font-semibold opacity-90 mb-1">Elektronik</p>
          <h2 id="totalElektronik" class="text-4xl font-extrabold">0</h2>
        </div>
        <svg fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round" stroke-linecap="round" class="w-14 h-14 opacity-30" viewBox="0 0 24 24"><path d="M8 7V3M16 7V3M12 15l-1 1h4l-1-1M3 13l1 4h16l1-4"/></svg>
      </div>

      <div class="bg-gradient-to-r from-green-600 to-green-500 text-white p-6 rounded-xl shadow-lg flex justify-between items-center hover:scale-[1.03] transition-transform cursor-default">
        <div>
          <p class="uppercase font-semibold opacity-90 mb-1">Furniture</p>
          <h2 id="totalFurniture" class="text-4xl font-extrabold">0</h2>
        </div>
        <svg fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round" stroke-linecap="round" class="w-14 h-14 opacity-30" viewBox="0 0 24 24"><path d="M4 21h16M4 10l16 1M12 3v18"/></svg>
      </div>

      <div class="bg-gradient-to-r from-orange-500 to-yellow-400 text-white p-6 rounded-xl shadow-lg flex justify-between items-center hover:scale-[1.03] transition-transform cursor-default">
        <div>
          <p class="uppercase font-semibold opacity-90 mb-1">Total Nilai</p>
          <h2 id="totalNilai" class="text-4xl font-extrabold">Rp 0</h2>
        </div>
        <svg fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round" stroke-linecap="round" class="w-14 h-14 opacity-30" viewBox="0 0 24 24">
          <path d="M3 17v-2a4 4 0 014-4h1m6 0h1a4 4 0 014 4v2m0 0v2m0-2l-4-4m0 0l-4 4m4-4v6" />
        </svg>
      </div>

    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-8">
      <div class="bg-white p-5 rounded-xl shadow-lg min-h-[180px]">
        <h3 class="font-bold mb-4 text-lg">Kondisi Barang</h3>
        <ul id="dashboardKondisi" class="list-disc list-inside text-gray-700">-</ul>
      </div>
      <div class="bg-white p-5 rounded-xl shadow-lg min-h-[180px]">
        <h3 class="font-bold mb-4 text-lg">Per Kategori</h3>
        <ul id="dashboardKategori" class="list-disc list-inside text-gray-700">-</ul>
      </div>
      <div class="bg-white p-5 rounded-xl shadow-lg min-h-[180px]">
        <h3 class="font-bold mb-4 text-lg">Per Lokasi</h3>
        <ul id="dashboardLokasi" class="list-disc list-inside text-gray-700">-</ul>
      </div>
    </div>
  </section>

  <!-- Daftar Barang -->
  <section id="items" class="hidden">
    <h1 class="text-3xl font-bold mb-1">Daftar Barang</h1>
    <p class="text-gray-700 mb-6 max-w-xl">Kelola inventaris barang kantor</p>

    <div class="flex flex-wrap justify-between items-center mb-5 bg-white p-4 rounded-xl shadow">
      <input id="search" oninput="applyFilters()" type="search" placeholder="Cari nama atau kode" class="w-full md:w-72 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-transparent mb-3 md:mb-0" />
      <select id="filterKategori" onchange="applyFilters()" class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-transparent mb-3 md:mb-0">
        <option value="Semua">Semua Kategori</option>
        <option value="Elektronik">Elektronik</option>
        <option value="Furniture">Furniture</option>
        <option value="Alat Tulis">Alat Tulis</option>
      </select>
      <select id="filterKondisi" onchange="applyFilters()" class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-transparent mb-3 md:mb-0">
        <option value="Semua">Semua Kondisi</option>
        <option value="Baik">Baik</option>
        <option value="Rusak">Rusak</option>
        <option value="Dalam Perbaikan">Dalam Perbaikan</option>
      </select>
      <button onclick="openModal()" class="inline-flex items-center gap-2 bg-blue-600 text-white px-5 py-2 rounded-lg shadow-md hover:bg-blue-700 transition">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 fill-white" viewBox="0 0 24 24"><path d="M12 5v14m-7-7h14"/></svg> Tambah Barang
      </button>
      <button onclick="exportExcel()" class="px-5 py-2 border border-gray-300 rounded-lg hover:bg-gray-100 transition ml-3">Excel</button>
      <button onclick="exportPDF()" class="px-5 py-2 border border-gray-300 rounded-lg hover:bg-gray-100 transition ml-1">PDF</button>
    </div>

    <div class="bg-white rounded-xl shadow overflow-x-auto">
      <table class="w-full text-left text-sm text-gray-700 divide-y divide-gray-200">
        <thead class="bg-gray-100 font-semibold">
          <tr>
            <th class="p-3">Kode</th>
            <th class="p-3">Nama</th>
            <th class="p-3">Kategori</th>
            <th class="p-3">Jumlah</th>
            <th class="p-3">Lokasi</th>
            <th class="p-3">Harga (Rp)</th>
            <th class="p-3">Kondisi</th>
            <th class="p-3">Status</th>
            <th class="p-3">Tanggal</th>
            <th class="p-3 text-center">Aksi</th>
          </tr>
        </thead>
        <tbody id="tableBody" class="divide-y divide-gray-100">
          <tr><td colspan="10" class="p-6 text-center text-gray-400">Tidak ada data barang</td></tr>
        </tbody>
      </table>
    </div>
  </section>
</main>

<!-- Modal Add/Edit -->
<div id="modal" class="fixed inset-0 bg-black bg-opacity-50 hidden justify-center items-center p-6 z-50">
  <div class="bg-white rounded-xl w-full max-w-3xl max-h-[90vh] overflow-y-auto shadow-lg px-8 py-6">
    <div class="flex justify-between mb-4 items-center">
      <h2 id="modalTitle" class="text-xl font-semibold">Tambah Barang Baru</h2>
      <button onclick="closeModal()" aria-label="Close" class="text-gray-600 hover:text-gray-900 text-3xl leading-none font-bold transition">&times;</button>
    </div>
    <p class="mb-6 text-gray-600">Masukkan informasi barang yang akan ditambahkan</p>

    <form id="itemForm" onsubmit="event.preventDefault(); saveItem();" class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div>
        <label for="kode" class="block mb-1 font-semibold text-gray-700">Kode Barang</label>
        <input id="kode" class="w-full p-3 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-transparent" placeholder="Kode Barang" required/>
      </div>
      <div>
        <label for="nama" class="block mb-1 font-semibold text-gray-700">Nama Barang</label>
        <input id="nama" class="w-full p-3 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-transparent" placeholder="Nama Barang" required />
      </div>
      <div>
        <label for="kategori" class="block mb-1 font-semibold text-gray-700">Kategori</label>
        <select id="kategori" class="w-full p-3 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-transparent">
          <option value="Elektronik">Elektronik</option>
          <option value="Furniture">Furniture</option>
          <option value="Alat Tulis">Alat Tulis</option>
        </select>
      </div>
      <div>
        <label for="jumlah" class="block mb-1 font-semibold text-gray-700">Jumlah</label>
        <input id="jumlah" type="number" min="1" class="w-full p-3 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-transparent" placeholder="Jumlah" required />
      </div>
      <div>
        <label for="lokasi" class="block mb-1 font-semibold text-gray-700">Lokasi</label>
        <input id="lokasi" class="w-full p-3 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-transparent" placeholder="Lokasi" />
      </div>
      <div>
        <label for="tanggal" class="block mb-1 font-semibold text-gray-700">Tanggal</label>
        <input id="tanggal" type="date" class="w-full p-3 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-transparent" />
      </div>
      <div>
        <label for="harga" class="block mb-1 font-semibold text-gray-700">Harga (Rp)</label>
        <input id="harga" type="number" min="0" class="w-full p-3 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-transparent" placeholder="Harga (Rp)" required />
      </div>
      <div>
        <label for="kondisi" class="block mb-1 font-semibold text-gray-700">Kondisi</label>
        <select id="kondisi" class="w-full p-3 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-transparent">
          <option value="Baik">Baik</option>
          <option value="Rusak Ringan">Rusak Ringan</option>
          <option value="Rusak Berat">Rusak Berat</option>
        </select>
      </div>
      <div>
        <label for="status" class="block mb-1 font-semibold text-gray-700">Status</label>
        <select id="status" class="w-full p-3 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-transparent">
          <option value="Tersedia">Tersedia</option>
          <option value="Dipinjam">Dipinjam</option>
          <option value="Tidak Tersedia">Tidak Tersedia</option>
        </select>
      </div>
      <div class="md:col-span-2">
      </div>
      <div class="md:col-span-2 flex justify-end gap-3 mt-4">
        <button type="button" onclick="closeModal()" class="px-6 py-2 bg-gray-300 rounded-lg font-semibold hover:bg-gray-400 transition">Batal</button>
        <button type="submit" id="saveBtn" class="px-6 py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition">Tambah Barang</button>
      </div>
    </form>
  </div>
</div>

<script>
  let items = [];
let editIndex = null;

function isKodeExists(kode, ignoreIndex = null) {
  return items.some((item, idx) => item.kode === kode && idx !== ignoreIndex);
}

  // Inisialisasi judul dan logo navbar (ubah di sini mudah)
  document.getElementById('navLogo').innerHTML = APP_LOGO_SVG;
  document.getElementById('navTitle').textContent = APP_TITLE;
  document.getElementById('navSubtitle').textContent = APP_SUBTITLE;

  const SHEET_ID = '1chfJsCaA8DbK6NkSTspyqP9mrN4Brl8Y10xoqMPHP2I';  // Ganti dengan Sheet ID Anda
const API_KEY = 'AIzaSyB2MXZFnOoePZctVz974TnVoDd1cxbb2NA';    // Ganti dengan API Key Anda
const RANGE = 'Sheet1!A:I';  // Range data, misalnya A:I untuk kolom A sampai I

async function loadItemsFromSheet() {
  try {
    const res = await fetch(
      "https://script.google.com/macros/s/AKfycbzIqxrqE-hR3fORrw5kf-tp86I8yewW88BX0MNhx_ZtYIncW89waGYW02X8jQF2uBV_fg/exec?read=1"
    );
    const data = await res.json();

    if (data.values) {
      items = data.values.slice(1).map(row => ({
        kode: row[0] || "",
        nama: row[1] || "",
        kategori: row[2] || "",
        jumlah: Number(row[3]) || 0,
        lokasi: row[4] || "",
        harga: Number(row[5]) || 0,
        tanggal: row[6] || "",
        kondisi: row[7] || "",
        status: row[8] || ""
      }));
    }
  } catch (e) {
    console.error(e);
    alert("Gagal memuat data dari Google Sheet");
  }
}
// Panggil ini di awal (ganti localStorage load)
async function initApp() {

  await loadItemsFromSheet();
  renderTable();
  updateDashboard();
  showPage('dashboard');
}

  function showPage(page) {
    document.getElementById('dashboard').classList.add('hidden');
    document.getElementById('items').classList.add('hidden');
    document.getElementById(page).classList.remove('hidden');
    updateDashboard();
    renderTable();
  }

  function openModal(edit = false, idx = null) {
    document.getElementById('modal').classList.remove('hidden');
    document.getElementById('modal').classList.add('flex');
    if (edit) {
      editIndex = idx;
      const it = items[idx];
      document.getElementById('modalTitle').innerText = 'Edit Barang';
      document.getElementById('kode').value = it.kode;
      document.getElementById('nama').value = it.nama;
      document.getElementById('kategori').value = it.kategori;
      document.getElementById('jumlah').value = it.jumlah;
      document.getElementById('harga').value = it.harga;
      document.getElementById('lokasi').value = it.lokasi;
      document.getElementById('tanggal').value = it.tanggal || '';
      document.getElementById('kondisi').value = it.kondisi || 'Baik';
      document.getElementById('status').value = it.status || 'Tersedia';
      document.getElementById('saveBtn').innerText = 'Simpan Perubahan';
    } else {
      editIndex = null;
      document.getElementById('modalTitle').innerText = 'Tambah Barang Baru';
      document.getElementById('kode').value = generateKode();
      document.getElementById('nama').value = '';
      document.getElementById('kategori').value = 'Elektronik';
      document.getElementById('jumlah').value = 1;
      document.getElementById('harga').value = 0;
      document.getElementById('lokasi').value = '';
      document.getElementById('tanggal').value = '';
      document.getElementById('kondisi').value = 'Baik';
      document.getElementById('status').value = 'Tersedia';
      document.getElementById('saveBtn').innerText = 'Tambah Barang';
    }
  }
  function closeModal() {
    document.getElementById('modal').classList.add('hidden');
    document.getElementById('modal').classList.remove('flex');
  }

  // Generate kode unik
  function generateKode() {
    const num = String(items.length + 1).padStart(4, '0');
    return `BRG-${num}`;
  }

  async function saveItem() {
  const it = {
    kode: document.getElementById("kode").value.trim(),
    nama: document.getElementById("nama").value.trim(),
    kategori: document.getElementById("kategori").value,
    jumlah: Number(document.getElementById("jumlah").value),
    lokasi: document.getElementById("lokasi").value,
    harga: Number(document.getElementById("harga").value),
    tanggal: document.getElementById("tanggal").value,
    kondisi: document.getElementById("kondisi").value,
    status: document.getElementById("status").value,
    mode: editIndex !== null ? "edit" : "add"
  };
// ==== VALIDASI KODE SUDAH ADA ====
if (editIndex !== null) {
  // EDIT MODE
  if (isKodeExists(it.kode, editIndex)) {
    alert("Kode barang ini sudah digunakan oleh item lain!");
    return;
  }
} else {
  // ADD MODE
  if (isKodeExists(it.kode)) {
    alert("Kode barang sudah ada! Gunakan kode lain.");
    return;
  }
}


  await fetch("https://script.google.com/macros/s/AKfycbzIqxrqE-hR3fORrw5kf-tp86I8yewW88BX0MNhx_ZtYIncW89waGYW02X8jQF2uBV_fg/exec", {
    method: "POST",
    body: JSON.stringify(it)
  });

  await loadItemsFromSheet();
  renderTable();
  updateDashboard();
  closeModal();
}
function onEdit(idx) {
  openModal(true, idx);
}

async function onDelete(idx) {
  if (!confirm("Hapus barang ini?")) return;

  const kode = items[idx].kode;

  await fetch(`https://script.google.com/macros/s/AKfycbzIqxrqE-hR3fORrw5kf-tp86I8yewW88BX0MNhx_ZtYIncW89waGYW02X8jQF2uBV_fg/exec?delete=1&kode=${kode}`);

  await loadItemsFromSheet();
  renderTable();
  updateDashboard();
}

  function renderTable() {
    const body = document.getElementById('tableBody');
    if (items.length === 0) {
      body.innerHTML = `<tr><td colspan="10" class="p-6 text-center text-gray-400">Tidak ada data barang</td></tr>`;
      return;
    }
    const searchTerm = (document.getElementById('search').value || '').toLowerCase();
    const kategoriFilter = document.getElementById('filterKategori').value;
    const kondisiFilter = document.getElementById('filterKondisi').value;

    const filtered = items.filter(i => {
      const matchesSearch = i.nama.toLowerCase().includes(searchTerm)
        || i.kode.toLowerCase().includes(searchTerm)
      const matchesKategori = kategoriFilter === 'Semua' || i.kategori === kategoriFilter;
      const matchesKondisi = kondisiFilter === 'Semua' || i.kondisi.includes(kondisiFilter);
      return matchesSearch && matchesKategori && matchesKondisi;
    });

    body.innerHTML = '';
    filtered.forEach((i, idx) => {
      const tr = document.createElement('tr');
      tr.className = 'hover:bg-blue-50 cursor-default';
      tr.innerHTML = `
        <td class='p-3'>${i.kode}</td>
        <td class='p-3 font-semibold'>${i.nama}</td>
        <td class='p-3'>${i.kategori}</td>
        <td class='p-3 text-center'>${i.jumlah}</td>
        <td class='p-3'>${i.lokasi || '-'}</td>
        <td class='p-3 text-right'>${formatRp(i.harga)}</td>
        <td class='p-3'>${i.kondisi}</td>
        <td class='p-3'>${i.status}</td>
        <td class='p-3'>${i.tanggal || '-'}</td>
        <td class='p-3 text-center'>
          <button onclick="onEdit(${idx})" class='text-sm px-3 py-1 bg-yellow-400 text-white rounded mr-2 hover:bg-yellow-500 transition'>Edit</button>
          <button onclick="onDelete(${idx})" class='text-sm px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 transition'>Hapus</button>
        </td>
      `;
      body.appendChild(tr);
    });

    if (filtered.length === 0) {
      body.innerHTML = `<tr><td colspan="10" class="p-6 text-center text-gray-400">Tidak ada data yang sesuai filter</td></tr>`;
    }
  }

function applyFilters() {
  renderTable();
}

  function onEdit(idx) {
    openModal(true, idx);
  }
  function updateDashboard() {
    const totalJml = items.reduce((s, it) => s + (it.jumlah || 0), 0);
    const totalElektronik = items.filter(i => i.kategori === 'Elektronik').reduce((s, it) => s + (it.jumlah || 0), 0);
    const totalFurniture = items.filter(i => i.kategori === 'Furniture').reduce((s, it) => s + (it.jumlah || 0), 0);
    const totalNilai = items.reduce((s, it) => s + ((it.harga || 0) * (it.jumlah || 1)), 0);

document.getElementById('totalBarang').innerText = totalJml;
document.getElementById('totalElektronik').innerText = totalElektronik;
document.getElementById('totalFurniture').innerText = totalFurniture;
document.getElementById('totalNilai').innerText = formatRp(totalNilai);


    updateDashboardDetails();
  }

  function updateDashboardDetails() {
    // Hitung jumlah per kondisi
    const kondisiCount = {};
    items.forEach(i => {
      const k = i.kondisi || 'Tidak Diketahui';
      kondisiCount[k] = (kondisiCount[k] || 0) + (i.jumlah || 0);
    });

    // Hitung jumlah per kategori
    const kategoriCount = {};
    items.forEach(i => {
      const k = i.kategori || 'Tidak Diketahui';
      kategoriCount[k] = (kategoriCount[k] || 0) + (i.jumlah || 0);
    });

    // Hitung jumlah per lokasi
    const lokasiCount = {};
    items.forEach(i => {
      const k = i.lokasi || 'Tidak Diketahui';
      lokasiCount[k] = (lokasiCount[k] || 0) + (i.jumlah || 0);
    });

    // Render list di dashboard
    const renderList = (id, data) => {
      const el = document.getElementById(id);
      if (!el) return;
      if (Object.keys(data).length === 0) {
        el.innerHTML = '<li>-</li>';
        return;
      }
      el.innerHTML = Object.entries(data)
        .map(([key, val]) => `<li>${key}: ${val} barang</li>`)
        .join('');
    };

    renderList('dashboardKondisi', kondisiCount);
    renderList('dashboardKategori', kategoriCount);
    renderList('dashboardLokasi', lokasiCount);
  }

  function numberWithCommas(x) {
    try { return new Intl.NumberFormat('id-ID').format(x); } catch(e) { return String(x); }
  }
  function formatRp(x) { return numberWithCommas(x || 0); }

  function applyFilters() {
    renderTable();
  }

  // Export ke Excel pakai SheetJS
  function exportExcel() {
    if (items.length === 0) { alert('Tidak ada data untuk diexport'); return; }
    const wsData = [["Kode","Nama","Kategori","Jumlah","Lokasi","Harga","Tanggal","Kondisi","Status",]];
    items.forEach(i => wsData.push([i.kode,i.nama,i.kategori,i.jumlah,i.lokasi,i.harga,i.tanggal,i.kondisi,i.status,i.status]));
    const wb = XLSX.utils.book_new();
    const ws = XLSX.utils.aoa_to_sheet(wsData);
    XLSX.utils.book_append_sheet(wb, ws, 'Inventaris');
    XLSX.writeFile(wb, 'inventaris.xlsx');
  }

  // Export ke PDF pakai jsPDF + autotable
  async function exportPDF() {
    if (items.length === 0) { alert('Tidak ada data untuk diexport'); return; }
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({putOnlyUsedFonts:true});
    const columns = [
      { header: 'Kode', dataKey: 'kode' },
      { header: 'Nama', dataKey: 'nama' },
      { header: 'Kategori', dataKey: 'kategori' },
      { header: 'Jumlah', dataKey: 'jumlah' },
      { header: 'Lokasi', dataKey: 'lokasi' },
      { header: 'Harga', dataKey: 'harga' },
      { header: 'Kondisi', dataKey: 'kondisi' },
      { header: 'Status', dataKey: 'status' },
    ];
    const rows = items.map(i => ({
      kode: i.kode,
      nama: i.nama,
      kategori: i.kategori,
      jumlah: i.jumlah,
      lokasi: i.lokasi,
      harga: formatRp(i.harga),
      kondisi: i.kondisi,
      status: i.status,
    }));
    doc.text('Daftar Inventaris', 14, 16);
    doc.autoTable({ startY: 22, columns, body: rows, styles: { fontSize: 8 } });
    doc.save('inventaris.pdf');
  }

  // Init UI
  renderTable();
  updateDashboard();
  showPage('dashboard');
</script>

</body>
</html>
